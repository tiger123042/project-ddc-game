<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8" />
  <title>‡∏à‡∏±‡∏î‡∏´‡∏°‡∏π‡πà‡∏´‡∏ô‡∏±‡∏á‡∏™‡∏∑‡∏≠ DDC</title>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>
  <link href="https://fonts.googleapis.com/css2?family=Kanit&display=swap" rel="stylesheet" />
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Kanit&display=swap');
    body {
      margin: 0;
      font-family: 'Kanit', sans-serif;
      background: #fef6e4 url('https://cdn.pixabay.com/photo/2016/11/29/10/07/notebook-1869347_1280.jpg') no-repeat center center fixed;
      background-size: cover;
      display: flex;
      flex-direction: column;
      align-items: center;
      min-height: 100vh;
      overflow: hidden;
      color: #3b2f2f;
    }
    h1 {
      margin: 20px;
      color: #d6336c;
      text-shadow: 1px 1px 2px #fff;
      font-size: 2.4rem;
      text-align: center;
    }
    #game-container {
      width: 90%;
      max-width: 700px;
      height: 70vh;
      background: #fff8f0;
      border-radius: 25px;
      box-shadow: 0 12px 24px rgba(0,0,0,0.3);
      display: flex;
      flex-direction: column;
      justify-content: flex-start;
      padding: 20px 40px 20px 320px; /* left padding ‡πÉ‡∏´‡πâ‡πÄ‡∏´‡∏•‡∏∑‡∏≠‡∏ó‡∏µ‡πà‡∏ß‡∏≤‡∏á‡∏£‡∏π‡∏õ‡∏ï‡∏±‡∏ß‡∏•‡∏∞‡∏Ñ‡∏£ */
      position: relative;
      overflow: hidden;
      cursor: default;
    }

    #game-container::before {
      content: "";
      position: absolute;
      top: 10px; bottom: 10px; left: 10px; right: 10px;
      border: 3px dashed #d18ca4;
      border-radius: 25px;
      pointer-events: none;
      mix-blend-mode: multiply;
      opacity: 0.3;
    }
    #dialog-box {
      max-width: 100%;
      width: 100%;
      padding: 10px;
      font-size: 1.2em;
      word-wrap: break-word;
      word-break: break-word;
      box-sizing: border-box;
      background-color: #fff;
      border-radius: 10px;
      margin-bottom: 12px;
      position: relative;
      z-index: 10;
      min-height: 70px;
      font-weight: bold;
      color: #3b2f2f;
    }
    #choices {
      margin-top: 10px;
      display: flex;
      flex-wrap: wrap;
      gap: 10px;
      justify-content: center;
      z-index: 20;
    }
    #choices button {
      flex: 1 1 45%;
      background: #d6336c;
      color: #fff;
      border: none;
      border-radius: 16px;
      padding: 14px;
      font-size: 1rem;
      cursor: pointer;
      transition: background 0.25s;
      box-shadow: 0 4px 8px #d6336c88;
      user-select: none;
    }
    #playerList {
  max-height: 150px;  /* ‡∏™‡∏π‡∏á‡∏™‡∏∏‡∏î‡∏ó‡∏µ‡πà‡πÉ‡∏´‡πâ‡πÅ‡∏™‡∏î‡∏á‡∏Å‡πà‡∏≠‡∏ô‡∏°‡∏µ scrollbar */
  overflow-y: auto;   /* ‡πÄ‡∏õ‡∏¥‡∏î scrollbar ‡πÅ‡∏ô‡∏ß‡∏ï‡∏±‡πâ‡∏á‡πÄ‡∏°‡∏∑‡πà‡∏≠‡πÄ‡∏ô‡∏∑‡πâ‡∏≠‡∏´‡∏≤‡∏¢‡∏≤‡∏ß‡πÄ‡∏Å‡∏¥‡∏ô */
  border: 1px solid #ddd;
  padding: 5px;
  margin-top: 10px;
  background: #f9f9f9;
}
    #choices button:hover:not(:disabled) {
      background: #a6284a;
      box-shadow: 0 6px 12px #a6284aaa;
    }
    #choices button:disabled {
      background: #ccc;
      color: #666;
      cursor: default;
      box-shadow: none;
    }
    #answerStats, #playerList {
      margin-top: 20px;
      background: #fff8f0cc;
      border-radius: 15px;
      padding: 15px 20px;
      box-shadow: 0 6px 12px #d18ca4aa;
      max-width: 100%;
      font-weight: bold;
      color: #3b2f2f;
      list-style: none;
    }
    #answerStats li, #playerList li {
      margin-bottom: 6px;
    }
    #info-row {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-top: 15px;
      font-size: 1.2rem;
      font-weight: bold;
      color: #ff6b6b;
    }
    #character-img {
      position: absolute;
      top: 120px;
      left: 40px;
      width: 280px;
      height: 420px;
      object-fit: contain;
      user-select: none;
      pointer-events: none;
      z-index: 5;
      filter: drop-shadow(3px 4px 4px rgba(0,0,0,0.3));
    }
    #leaderboard {
      display: none;
      margin-top: 20px;
      background: #fff8f0cc;
      border-radius: 15px;
      padding: 15px 20px;
      box-shadow: 0 6px 12px #d18ca4aa;
      max-width: 100%;
      color: #3b2f2f;
      font-weight: bold;
    }
    #leaderboard table {
      width: 100%;
      border-collapse: collapse;
      text-align: center;
    }
    #leaderboard th, #leaderboard td {
      border: 1px solid #d18ca4;
      padding: 8px;
    }
    @media (max-width: 600px) {
      #game-container {
        padding-left: 20px;
      }
      #character-img {
        display: none;
      }
      #choices button {
        flex: 1 1 100%;
      }
    }
    /* ‡∏õ‡∏∏‡πà‡∏°‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î */
    button {
      font-family: 'Kanit', sans-serif;
      font-size: 1.2rem;
      padding: 10px 20px;
      margin: 8px;
      border: none;
      border-radius: 20px;
      cursor: pointer;
      transition: all 0.3s ease;
      box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
      display: inline-flex;
      align-items: center;
      gap: 8px;
    }
    /* ‡∏õ‡∏∏‡πà‡∏°‡πÅ‡∏ï‡πà‡∏•‡∏∞‡∏™‡∏µ */
    button[onclick*="startGame"] {
      background-color: #fddde6;
      color: #d63384;
    }
    button[onclick*="nextQuestion"] {
      background-color: #ddf0ff;
      color: #007bff;
    }
    button[onclick*="endGame"] {
      background-color: #ffe4cc;
      color: #ff6600;
    }
    button[onclick*="resetGame"] {
      background-color: #e6ffdd;
      color: #28a745;
    }
    /* hover effect */
    button:hover {
      transform: scale(1.05);
      box-shadow: 0 6px 14px rgba(0, 0, 0, 0.15);
    }
    /* focus (keyboard nav) */
    button:focus {
      outline: none;
      box-shadow: 0 0 0 3px rgba(0, 123, 255, 0.4);
    }
  </style>
</head>
<body>
  <h1>üìö ‡∏à‡∏±‡∏î‡∏´‡∏°‡∏π‡πà‡∏´‡∏ô‡∏±‡∏á‡∏™‡∏∑‡∏≠ DDC</h1>

  <div id="game-container">
    <div id="dialog-box">‡∏Å‡∏î ‡πÄ‡∏£‡∏¥‡πà‡∏°‡πÄ‡∏Å‡∏° ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏£‡∏¥‡πà‡∏°</div>

    <div id="choices"></div>

    <ul id="answerStats"></ul>

    <ul id="playerList"></ul>

    <div id="info-row"></div>

    <img id="character-img" src="mind.png" alt="‡∏ï‡∏±‡∏ß‡∏•‡∏∞‡∏Ñ‡∏£" />
    
    <div id="leaderboard">
      <h2>üèÜ Leaderboard</h2>
      <table>
        <thead>
          <tr>
            <th>‡∏≠‡∏±‡∏ô‡∏î‡∏±‡∏ö</th>
            <th>‡∏ä‡∏∑‡πà‡∏≠</th>
            <th>‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô</th>
          </tr>
        </thead>
        <tbody id="leaderboard-body"></tbody>
      </table>
    </div>
  </div>

  <div style="text-align:center; margin-top:10px; width:90%; max-width:700px;">
    <button onclick="startGame()">‚ñ∂Ô∏è ‡πÄ‡∏£‡∏¥‡πà‡∏°‡πÄ‡∏Å‡∏°</button>
    <button onclick="nextQuestion()">‚û°Ô∏è ‡∏Ñ‡∏≥‡∏ñ‡∏≤‡∏°‡∏ñ‡∏±‡∏î‡πÑ‡∏õ</button>
    <button onclick="endGame()">‚õî ‡∏à‡∏ö‡πÄ‡∏Å‡∏°</button>
    <button onclick="resetGame()">üîÑ ‡πÄ‡∏£‡∏¥‡πà‡∏°‡πÉ‡∏´‡∏°‡πà (‡∏•‡πâ‡∏≤‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•)</button>
    <button onclick="downloadScores()">üì• ‡∏î‡∏≤‡∏ß‡∏ô‡πå‡πÇ‡∏´‡∏•‡∏î‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô</button>
  </div>

  <audio id="bgm" loop preload="auto">
    <source src="background-music.mp3" type="audio/mpeg" />
  </audio>
  <audio id="wrong-sound" src="wrong.mp3" preload="auto"></audio>

  <script>
    // 1) ‡∏Å‡∏≥‡∏´‡∏ô‡∏î Firebase config ‡πÅ‡∏•‡∏∞ initialize
    const firebaseConfig = {
      apiKey: "AIzaSyDS0LklfDoBqDsL_ghsjLTKSQHE7n6pwZs",
      authDomain: "gameddc-78b15.firebaseapp.com",
      databaseURL: "https://gameddc-78b15-default-rtdb.asia-southeast1.firebasedatabase.app",
      projectId: "gameddc-78b15",
      storageBucket: "gameddc-78b15.appspot.com",
      messagingSenderId: "1029473303694",
      appId: "1:1029473303694:web:d773ccddbb152495f79ddf",
      measurementId: "G-8DB314K2EJ"
    };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();
    const gameId = "myGame";

    const wrongSound = document.getElementById('wrong-sound');

    // ‡∏Ñ‡∏≥‡∏ñ‡∏≤‡∏°‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á
    const sampleQuestions = [
      {
        question: "600 ‡∏Ñ‡∏∑‡∏≠‡∏Å‡∏•‡∏∏‡πà‡∏°‡∏´‡∏°‡∏ß‡∏î‡∏´‡∏°‡∏π‡πà‡πÉ‡∏î‡πÉ‡∏ô‡∏£‡∏∞‡∏ö‡∏ö DDC?",
        choices: ["‡∏®‡∏≤‡∏™‡∏ô‡∏≤", "‡πÄ‡∏ó‡∏Ñ‡πÇ‡∏ô‡πÇ‡∏•‡∏¢‡∏µ", "‡∏†‡∏≤‡∏©‡∏≤", "‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå"],
        answer: 1,
        image: "https://tiger123042.github.io/project-ddc-game/mind2.png"
      },
      {
        question: "100 ‡∏Ñ‡∏∑‡∏≠‡∏Å‡∏•‡∏∏‡πà‡∏°‡∏´‡∏°‡∏ß‡∏î‡∏´‡∏°‡∏π‡πà‡πÉ‡∏î‡πÉ‡∏ô‡∏£‡∏∞‡∏ö‡∏ö DDC?",
        choices: ["‡∏õ‡∏£‡∏±‡∏ä‡∏ç‡∏≤‡πÅ‡∏•‡∏∞‡∏à‡∏¥‡∏ï‡∏ß‡∏¥‡∏ó‡∏¢‡∏≤", "‡∏ß‡∏¥‡∏ó‡∏¢‡∏≤‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå", "‡∏®‡∏¥‡∏•‡∏õ‡∏∞", "‡∏†‡∏≤‡∏©‡∏≤"],
        answer: 0,
        image: "https://tiger123042.github.io/project-ddc-game/mindgif.gif"
      }
    ];

    let countdown = null;
    let timeLeft = 10;

    // ‡πÄ‡∏£‡∏¥‡πà‡∏°‡πÄ‡∏Å‡∏°
    function startGame() {
      db.ref("games/" + gameId + "/players").once("value").then((snap) => {
        const players = snap.val() || {};
        const playerCount = Object.keys(players).length;

        if (playerCount === 0) {
          alert("‚ö†Ô∏è ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÉ‡∏´‡πâ‡∏ú‡∏π‡πâ‡πÄ‡∏•‡πà‡∏ô‡πÄ‡∏Ç‡πâ‡∏≤‡∏£‡πà‡∏ß‡∏°‡∏Å‡πà‡∏≠‡∏ô‡πÄ‡∏£‡∏¥‡πà‡∏°‡πÄ‡∏Å‡∏°");
          return;
        }

        const bgm = document.getElementById("bgm");
        if (bgm) {
          bgm.play().catch(err => {
            console.warn("‡πÄ‡∏û‡∏•‡∏á‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÄ‡∏•‡πà‡∏ô‡πÑ‡∏î‡πâ‡∏à‡∏ô‡∏Å‡∏ß‡πà‡∏≤‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏à‡∏∞‡∏Ñ‡∏•‡∏¥‡∏Å‡∏ö‡∏≤‡∏á‡∏≠‡∏¢‡πà‡∏≤‡∏á", err);
          });
        }
        document.getElementById("playerList").style.display = "none";
        db.ref("games/" + gameId).update({
          status: "playing",
          currentQuestionIndex: 0,
          questions: sampleQuestions,
          players: players
        });

        showCountdown();
      });
    }

    // ‡∏Ñ‡∏≥‡∏ñ‡∏≤‡∏°‡∏ñ‡∏±‡∏î‡πÑ‡∏õ
    function nextQuestion() {
      db.ref("games/" + gameId + "/currentQuestionIndex").once("value").then((snap) => {
        let current = snap.val() || 0;
        current++;
        if (current >= sampleQuestions.length) {
          endGame();
          return;
        }
        db.ref("games/" + gameId + "/currentQuestionIndex").set(current);
        db.ref("games/" + gameId + "/answers").remove(); // ‡∏•‡πâ‡∏≤‡∏á‡∏Ñ‡∏≥‡∏ï‡∏≠‡∏ö‡πÄ‡∏Å‡πà‡∏≤‡πÄ‡∏°‡∏∑‡πà‡∏≠‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏Ç‡πâ‡∏≠
        showCountdown();
      });
    }

    // ‡∏à‡∏ö‡πÄ‡∏Å‡∏°
    function endGame() {
      db.ref("games/" + gameId + "/status").set("ended");
      clearInterval(countdown);
      document.getElementById("dialog-box").innerText = "üéâ ‡πÄ‡∏Å‡∏°‡∏à‡∏ö‡πÅ‡∏•‡πâ‡∏ß";
      document.getElementById("choices").innerHTML = "";
      document.getElementById("answerStats").innerHTML = "";
      document.getElementById("playerList").innerHTML = "";
      document.getElementById("info-row").innerText = "";
      showLeaderboard();
    }

    // ‡∏£‡∏µ‡πÄ‡∏ã‡πá‡∏ï‡πÄ‡∏Å‡∏° (‡∏•‡πâ‡∏≤‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•)
    function resetGame() {
      db.ref("games").remove().then(() => {
        location.reload();
      });
    }

    // ‡πÅ‡∏™‡∏î‡∏á‡∏Ñ‡∏≥‡∏ñ‡∏≤‡∏°‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô‡πÅ‡∏•‡∏∞‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏∑‡∏≠‡∏Å
    db.ref("games/" + gameId).on("value", (snap) => {
      const game = snap.val();
      if (!game || !game.questions) return;

      const qIndex = game.currentQuestionIndex || 0;

      if (game.status === "playing" && qIndex < game.questions.length) {
        const q = game.questions[qIndex];
        document.getElementById("character-img").src = q.image || "mind.png";
        document.getElementById("dialog-box").innerText = "‚ùì " + q.question;
        document.getElementById("choices").innerHTML = q.choices.map((choice, idx) =>
          `<button disabled>${choice}</button>`
        ).join('');
        // ‡∏ã‡πà‡∏≠‡∏ô leaderboard ‡∏ñ‡πâ‡∏≤‡πÇ‡∏ä‡∏ß‡πå‡∏≠‡∏¢‡∏π‡πà
        document.getElementById("leaderboard").style.display = "none";
      } else if (game.status === "ended") {
        wrongSound.play();
        document.getElementById("dialog-box").innerText = "üéâ ‡πÄ‡∏Å‡∏°‡∏à‡∏ö‡πÅ‡∏•‡πâ‡∏ß";
        document.getElementById("choices").innerHTML = "";
      } else {
        document.getElementById("dialog-box").innerText = "";
        document.getElementById("choices").innerHTML = "";
      }
    });

    // ‡πÅ‡∏™‡∏î‡∏á‡∏ä‡∏∑‡πà‡∏≠‡πÅ‡∏•‡∏∞‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡∏ú‡∏π‡πâ‡πÄ‡∏•‡πà‡∏ô
    db.ref("games/" + gameId + "/players").on("value", (snap) => {
      const players = snap.val() || {};
      const ul = document.getElementById("playerList");
      ul.innerHTML = "";
      for (const key in players) {
        const p = players[key];
        const name = p.name || "‡πÑ‡∏°‡πà‡∏ó‡∏£‡∏≤‡∏ö‡∏ä‡∏∑‡πà‡∏≠";
        const score = p.score || 0;
        const li = document.createElement("li");
        li.innerText = `${name}: ${score} ‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô`;
        ul.appendChild(li);
      }
    });

    // ‡∏ô‡∏±‡∏ö‡∏ñ‡∏≠‡∏¢‡∏´‡∏•‡∏±‡∏á‡πÄ‡∏ß‡∏•‡∏≤
    function showCountdown() {
      clearInterval(countdown);
      timeLeft = 10;
      updateAnswerStats(false);

      countdown = setInterval(() => {
        if (timeLeft <= 0) {
          clearInterval(countdown);
          updateAnswerStats(true);
        } else {
          document.getElementById("info-row").innerText = `‚è≥ ‡πÄ‡∏´‡∏•‡∏∑‡∏≠‡πÄ‡∏ß‡∏•‡∏≤ ${timeLeft} ‡∏ß‡∏¥‡∏ô‡∏≤‡∏ó‡∏µ`;
          timeLeft--;
        }
      }, 1000);
    }

    // ‡πÅ‡∏™‡∏î‡∏á‡∏™‡∏ñ‡∏¥‡∏ï‡∏¥‡∏Ñ‡∏≥‡∏ï‡∏≠‡∏ö
    function updateAnswerStats(showStats) {
      const answerStatsEl = document.getElementById("answerStats");

      if (!showStats) {
        answerStatsEl.innerHTML = `<li>‚è≥ ‡∏£‡∏≠‡∏´‡∏°‡∏î‡πÄ‡∏ß‡∏•‡∏≤‡∏ô‡∏±‡∏ö‡∏ñ‡∏≠‡∏¢‡∏´‡∏•‡∏±‡∏á...</li>`;
        return;
      }

      db.ref("games/" + gameId).once("value").then((snap) => {
        const game = snap.val();
        if (!game || !game.questions) return;

        const qIndex = game.currentQuestionIndex || 0;
        const choices = (game.questions[qIndex] && game.questions[qIndex].choices) || [];

        // ‡∏≠‡πà‡∏≤‡∏ô‡∏Ñ‡∏≥‡∏ï‡∏≠‡∏ö‡∏Ç‡∏≠‡∏á‡∏ú‡∏π‡πâ‡πÄ‡∏•‡πà‡∏ô‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î
        db.ref("games/" + gameId + "/answers").once("value").then((answersSnap) => {
          const answers = answersSnap.val() || {};
          let counts = new Array(choices.length).fill(0);
          Object.values(answers).forEach(a => {
            if (typeof a.choiceIndex === "number" && a.choiceIndex >= 0 && a.choiceIndex < choices.length) {
              counts[a.choiceIndex]++;
            }
          });

          answerStatsEl.innerHTML = choices.map((choice, i) =>
            `<li>${choice}: ${counts[i]} ‡∏Ñ‡∏ô</li>`
          ).join("");
          document.getElementById("info-row").innerText = "‚è∞ ‡∏´‡∏°‡∏î‡πÄ‡∏ß‡∏•‡∏≤‡πÅ‡∏•‡πâ‡∏ß!";
          wrongSound.play();
        });
      });
    }

    // ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏î‡∏≤‡∏ß‡∏ô‡πå‡πÇ‡∏´‡∏•‡∏î‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô
    function downloadScores() {
      const gameRef = db.ref("games/" + gameId + "/players");
      gameRef.once("value").then((snapshot) => {
        const players = snapshot.val() || {};
        let content = "üìä ‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô \n\n";

        // ‡πÅ‡∏õ‡∏•‡∏á‡πÄ‡∏õ‡πá‡∏ô array ‡πÅ‡∏•‡πâ‡∏ß‡πÄ‡∏£‡∏µ‡∏¢‡∏á‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡∏à‡∏≤‡∏Å‡∏°‡∏≤‡∏Å‡πÑ‡∏õ‡∏ô‡πâ‡∏≠‡∏¢
        const sortedPlayers = Object.entries(players).sort(([, a], [, b]) => (b.score || 0) - (a.score || 0));

        for (const [, player] of sortedPlayers) {
          const name = player.name || "‡πÑ‡∏°‡πà‡∏£‡∏∞‡∏ö‡∏∏‡∏ä‡∏∑‡πà‡∏≠";
          const score = player.score || 0;
          content += `üë§ ${name}: ${score} ‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô\n`;
        }

        // ‡∏™‡∏£‡πâ‡∏≤‡∏á Blob ‡πÅ‡∏•‡πâ‡∏ß‡∏î‡∏≤‡∏ß‡∏ô‡πå‡πÇ‡∏´‡∏•‡∏î
        const blob = new Blob([content], { type: "text/plain;charset=utf-8" });
        const url = URL.createObjectURL(blob);
        const a = document.createElement("a");
        a.href = url;
        a.download = "‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô.txt";
        document.body.appendChild(a);
        a.click();
        document.body.removeChild(a);
        URL.revokeObjectURL(url);
      });
    }

    // ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡πÇ‡∏ä‡∏ß‡πå Leaderboard
    function showLeaderboard() {
      const playersRef = db.ref("games/" + gameId + "/players");
      playersRef.once("value").then(snapshot => {
        const players = snapshot.val() || {};

        // ‡πÅ‡∏õ‡∏•‡∏á‡πÄ‡∏õ‡πá‡∏ô array ‡πÅ‡∏•‡πâ‡∏ß‡πÄ‡∏£‡∏µ‡∏¢‡∏á‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô
        const sortedPlayers = Object.values(players).sort((a, b) => (b.score || 0) - (a.score || 0));

        let tbodyHTML = "";
        sortedPlayers.forEach((player, index) => {
          tbodyHTML += `
            <tr>
              <td>${index + 1}</td>
              <td>${player.name || "‡πÑ‡∏°‡πà‡∏£‡∏∞‡∏ö‡∏∏‡∏ä‡∏∑‡πà‡∏≠"}</td>
              <td>${player.score || 0}</td>
            </tr>
          `;
        });

        // ‡πÉ‡∏™‡πà‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏ô‡∏ï‡∏≤‡∏£‡∏≤‡∏á
        document.getElementById("leaderboard-body").innerHTML = tbodyHTML;

        // ‡∏ã‡πà‡∏≠‡∏ô‡∏£‡∏π‡∏õ‡∏ï‡∏±‡∏ß‡∏•‡∏∞‡∏Ñ‡∏£ ‡πÅ‡∏•‡πâ‡∏ß‡πÇ‡∏ä‡∏ß‡πå Leaderboard
        document.getElementById("character-img").style.display = "none";
        document.getElementById("leaderboard").style.display = "block";
      });
    }

    // ‡∏ï‡∏£‡∏ß‡∏à‡∏à‡∏±‡∏ö‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡πÄ‡∏Å‡∏°‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô ‡∏ñ‡πâ‡∏≤ ended ‡πÉ‡∏´‡πâ‡πÇ‡∏ä‡∏ß‡πå Leaderboard
    db.ref("games/" + gameId + "/status").on("value", (snapshot) => {
      if (snapshot.val() === "ended") {
        showLeaderboard();
      }
    });
  </script>
</body>
</html>
