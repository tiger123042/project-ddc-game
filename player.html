<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8" />
  <title>‡∏à‡∏±‡∏î‡∏´‡∏°‡∏π‡πà‡∏´‡∏ô‡∏±‡∏á‡∏™‡∏∑‡∏≠ DDC</title>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Kanit&display=swap');
    body {
      margin: 0;
      font-family: 'Kanit', sans-serif;
      background: #fef6e4 url('https://cdn.pixabay.com/photo/2016/11/29/10/07/notebook-1869347_1280.jpg') no-repeat center center fixed;
      background-size: cover;
      display: flex;
      flex-direction: column;
      align-items: center;
      min-height: 100vh;
      overflow: hidden;
      color: #3b2f2f;
      position: relative;
    }
    h1 {
      margin: 20px;
      color: #d6336c;
      text-shadow: 1px 1px 2px #fff;
      font-size: 2.4rem;
      text-align: center;
    }
    #game-container {
      width: 90%;
      max-width: 700px;
      height: 70vh;
      background: #fff0f5; /* ‡∏™‡∏µ‡∏ä‡∏°‡∏û‡∏π‡∏≠‡πà‡∏≠‡∏ô */
      border-radius: 25px;
      box-shadow: 0 12px 24px rgba(204, 85, 156, 0.4);
      display: flex;
      flex-direction: column;
      justify-content: flex-start;
      padding: 20px 40px 20px 320px;
      position: relative;
      overflow: hidden;
      cursor: default;
    }
    #game-container::before {
      content: "";
      position: absolute;
      top: 10px; bottom: 10px; left: 10px; right: 10px;
      border: 3px dashed #d18ca4;
      border-radius: 25px;
      pointer-events: none;
      mix-blend-mode: multiply;
      opacity: 0.3;
    }
    #dialog-box {
      max-width: 100%;
      width: 100%;
      padding: 20px 25px;
      font-size: 1.4em;
      word-wrap: break-word;
      word-break: break-word;
      box-sizing: border-box;
      background-color: #fff;
      border-radius: 25px;
      margin-bottom: 20px;
      position: relative;
      z-index: 10;
      min-height: 100px;
      font-weight: 900;
      color: #5a2a5d;
      text-align: center;
      box-shadow: 0 6px 16px rgba(204, 85, 156, 0.3);
      user-select: none;
    }
    #choices {
      margin-top: 10px;
      display: flex;
      flex-wrap: wrap;
      gap: 16px;
      justify-content: center;
      z-index: 20;
    }
    #choices button {
      flex: 1 1 45%;
      background: linear-gradient(135deg, #cc559c, #eb7fc1);
      color: #fff;
      border: none;
      border-radius: 22px;
      padding: 18px;
      font-size: 1.1rem;
      font-weight: 700;
      cursor: pointer;
      box-shadow: 0 6px 12px #d6336cbb;
      user-select: none;
      transition: transform 0.2s ease, box-shadow 0.2s ease, background 0.3s ease;
      text-shadow: 0 1px 2px rgba(0,0,0,0.2);
    }
    #choices button:hover:not(:disabled) {
      transform: scale(1.07);
      background: linear-gradient(135deg, #a6284a, #cc559c);
      box-shadow: 0 8px 20px #a6284aaa;
    }
    #choices button:disabled {
      background: #ccc;
      color: #666;
      cursor: default;
      box-shadow: none;
      transform: none;
    }
    #score-display,
    #timer-display {
      margin-top: 10px;
      font-size: 1.3rem;
      color: #d6336c;
      font-weight: 900;
      text-align: center;
      z-index: 20;
      background: rgba(255, 255, 255, 0.9);
      border-radius: 18px;
      padding: 8px 14px;
      user-select: none;
      box-shadow: 0 4px 12px rgba(204, 85, 156, 0.3);
      width: fit-content;
      margin-left: auto;
      margin-right: auto;
    }
    #character-img {
      position: absolute;
      top: 120px;
      left: 40px;
      width: 280px;
      height: 420px;
      object-fit: contain;
      user-select: none;
      pointer-events: none;
      z-index: 5;
      filter: drop-shadow(3px 4px 4px rgba(0,0,0,0.3));
      transition: filter 0.3s ease;
    }
    #nameInputContainer {
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      background: #fff0f5;
      border-radius: 30px;
      box-shadow: 0 12px 24px rgba(204, 85, 156, 0.5);
      padding: 30px 40px;
      width: 90%;
      max-width: 400px;
      text-align: center;
      z-index: 20;
      user-select: none;
    }
    #nameInputContainer label {
      font-weight: 900;
      color: #cc559c;
      font-size: 1.3rem;
      user-select: none;
    }
    #playerName {
      margin-left: 8px;
      font-size: 1.2rem;
      padding: 8px 14px;
      border-radius: 18px;
      border: 3px solid #d6336c;
      outline-color: #a6284a;
      width: 180px;
      user-select: text;
    }
    #joinBtn {
      margin-top: 18px;
      background: linear-gradient(135deg, #cc559c, #eb7fc1);
      border: none;
      border-radius: 25px;
      padding: 14px 36px;
      font-size: 1.25rem;
      color: white;
      cursor: pointer;
      box-shadow: 0 7px 14px #d6336cbb;
      transition: background 0.3s, transform 0.15s ease;
      user-select: none;
      font-weight: 700;
    }
    #joinBtn:hover {
      background: linear-gradient(135deg, #a6284a, #cc559c);
      box-shadow: 0 9px 18px #a6284aaa;
      transform: scale(1.05);
    }
    .correct {
      background-color: #28a745 !important; /* ‡∏™‡∏µ‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ß */
      box-shadow: 0 0 14px 5px #28a745cc !important;
      color: white !important;
    }
    .wrong {
      background-color: #dc3545 !important; /* ‡∏™‡∏µ‡πÅ‡∏î‡∏á */
      box-shadow: 0 0 14px 5px #dc3545cc !important;
      color: white !important;
    }

    /* Mobile Styles */
    @media (max-width: 600px) {
      #game-container {
        padding-left: 20px !important;
        padding-top: 280px !important; /* ‡πÄ‡∏ß‡πâ‡∏ô‡∏ó‡∏µ‡πà‡πÉ‡∏´‡πâ‡∏†‡∏≤‡∏û‡∏ï‡∏±‡∏ß‡∏•‡∏∞‡∏Ñ‡∏£‡πÅ‡∏™‡∏î‡∏á */
        padding-right: 20px !important;
        min-height: 60vh;
        background-image: url('mind.png');
        background-repeat: no-repeat;
        background-position: top center;
        background-size: 280px 350px;
        border-radius: 20px;
        box-shadow: 0 8px 18px rgba(204,85,156,0.3);
      }
      #character-img {
        display: none !important;
      }
      #dialog-box {
        font-size: 1.1rem;
        margin-top: 10px;
        background: rgba(255 255 255 / 0.9);
        border-radius: 20px;
        padding: 16px;
        text-align: center;
        position: relative;
        z-index: 10;
        min-height: 70px;
        font-weight: 900;
        color: #5a2a5d;
        box-shadow: 0 4px 10px rgba(204, 85, 156, 0.25);
      }
      #choices {
        margin-top: 10px;
        flex-direction: column !important;
        gap: 12px !important;
        justify-content: center !important;
        display: flex !important;
      }
      #choices button {
        flex: none !important;
        width: 100% !important;
        font-size: 2rem;
        padding: 16px;
        border-radius: 24px;
      }
      #nameInputContainer {
        width: 90%;
        padding: 24px 32px;
        position: relative !important;
        top: auto !important;
        left: auto !important;
        transform: none !important;
        z-index: 20;
        background: #fff0f5;
        border-radius: 30px;
        box-shadow: 0 12px 24px rgba(204, 85, 156, 0.5);
      }
      #playerName {
        width: 100%;
      }
    }
  </style>
</head>
<body>
  <h1>üë§ ‡∏ú‡∏π‡πâ‡πÄ‡∏•‡πà‡∏ô</h1>

  <div id="game-container">
    <img id="character-img" src="mind.png" alt="‡∏ï‡∏±‡∏ß‡∏•‡∏∞‡∏Ñ‡∏£" />

    <div id="nameInputContainer">
      <label>‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏ä‡∏∑‡πà‡∏≠:
        <input type="text" id="playerName" />
      </label>
      <button id="joinBtn">‡πÄ‡∏Ç‡πâ‡∏≤‡∏£‡πà‡∏ß‡∏°‡πÄ‡∏Å‡∏°</button>
    </div>

    <div id="dialog-box" style="display:none;"></div>

    <div id="choices"></div>

    <div id="timer-display"></div>

    <div id="score-display"></div>
  </div>

  <audio id="bgm" loop preload="auto">
    <source src="background-music.mp3" type="audio/mpeg">
  </audio>
  <audio id="correct-sound" src="correct.mp3" preload="auto"></audio>
  <audio id="wrong-sound" src="wrong.mp3" preload="auto"></audio>
  <audio id="yay-sound" src="yay.mp3" preload="auto"></audio>

  <script>
    const correctSound = document.getElementById('correct-sound');
    const yaySound = document.getElementById('yay-sound');
    const wrongSound = document.getElementById('wrong-sound');
    const firebaseConfig = {
      apiKey: "AIzaSyDS0LklfDoBqDsL_ghsjLTKSQHE7n6pwZs",
      authDomain: "gameddc-78b15.firebaseapp.com",
      databaseURL: "https://gameddc-78b15-default-rtdb.asia-southeast1.firebasedatabase.app",
      projectId: "gameddc-78b15",
      storageBucket: "gameddc-78b15.appspot.com",
      messagingSenderId: "1029473303694",
      appId: "1:1029473303694:web:d773ccddbb152495f79ddf",
      measurementId: "G-8DB314K2EJ"
    };

    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();
    const gameId = "myGame";

    let playerKey = null;
    let playerName = "";
    let score = 0;
    let answered = false;
    let currentIndex = -1;
    let timerInterval;

    const nameInputContainer = document.getElementById("nameInputContainer");
    const joinBtn = document.getElementById("joinBtn");
    const statusDiv = document.getElementById("dialog-box");
    const choicesDiv = document.getElementById("choices");
    const timerDiv = document.getElementById("timer-display");
    const scoreDisplay = document.getElementById("score-display");

    joinBtn.onclick = () => {
      const inputName = document.getElementById("playerName").value.trim();
      if (!inputName) {
        alert("‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏ä‡∏∑‡πà‡∏≠‡∏Å‡πà‡∏≠‡∏ô‡πÄ‡∏Ç‡πâ‡∏≤‡∏£‡πà‡∏ß‡∏°‡πÄ‡∏Å‡∏°");
        return;
      }
      playerName = inputName;
      joinGame();
    };

    function joinGame() {
      db.ref(`games/${gameId}/players`).push({ name: playerName, score: 0 }).then(ref => {
        playerKey = ref.key;
        nameInputContainer.style.display = "none";
        statusDiv.style.display = "block";
        statusDiv.innerText = "‚è≥ ‡∏£‡∏≠‡πÄ‡∏£‡∏¥‡πà‡∏°‡πÄ‡∏Å‡∏°...";
        listenGame();
      });
    }

    function listenGame() {
      db.ref(`games/${gameId}`).on("value", snap => {
        const game = snap.val();
        if (!game) {
          statusDiv.innerText = "‚ùå ‡πÄ‡∏Å‡∏°‡πÑ‡∏°‡πà‡∏û‡∏£‡πâ‡∏≠‡∏°‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô";
          choicesDiv.innerHTML = "";
          statusDiv.style.display = "block";
          timerDiv.innerText = "";
          scoreDisplay.innerText = "";
          location.reload();
          return;
        }

        if (game.status === "waiting") {
          statusDiv.innerText = "‚è≥ ‡∏£‡∏≠‡πÄ‡∏£‡∏¥‡πà‡∏°‡πÄ‡∏Å‡∏°...";
          choicesDiv.innerHTML = "";
          statusDiv.style.display = "block";
          timerDiv.innerText = "";
          scoreDisplay.innerText = "";
          currentIndex = -1;
        } else if (game.status === "playing") {
          if (game.currentQuestionIndex !== currentIndex && game.questions && game.questions[game.currentQuestionIndex]) {
            const bgm = document.getElementById("bgm");
            if (bgm && bgm.paused) {
              bgm.play().catch(() => {});
            }

            currentIndex = game.currentQuestionIndex;
            answered = false;
            clearInterval(timerInterval);
            showQuestion(game.questions[currentIndex], currentIndex);
            startTimer(10);
            updateScore(game);
          }
        } else if (game.status === "ended") {
          statusDiv.innerText = `üéâ ‡πÄ‡∏Å‡∏°‡∏à‡∏ö‡πÅ‡∏•‡πâ‡∏ß! ‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡∏™‡∏∏‡∏î‡∏ó‡πâ‡∏≤‡∏¢: ${score}`;
          choicesDiv.innerHTML = "";
          timerDiv.innerText = "";
          currentIndex = -1;
        }
      });
    }

    function showQuestion(question, qIndex) {
      statusDiv.innerText = question.question;
      choicesDiv.innerHTML = "";

      // ‡πÅ‡∏™‡∏î‡∏á‡∏†‡∏≤‡∏û‡∏°‡∏≤‡∏¢‡∏î‡πå‡∏ï‡∏≤‡∏° URL ‡∏ó‡∏µ‡πà‡∏°‡∏≤‡∏Å‡∏±‡∏ö‡∏Ñ‡∏≥‡∏ñ‡∏≤‡∏°
      const characterImg = document.getElementById("character-img");
      if (question.image) {
        characterImg.src = question.image;
      } else {
        characterImg.src = "mind.png"; // ‡∏£‡∏π‡∏õ default
      }

      question.choices.forEach((choice, idx) => {
        const btn = document.createElement("button");
        btn.innerText = choice;
        btn.disabled = false;
        btn.onclick = () => submitAnswer(idx, question.answer, qIndex);
        choicesDiv.appendChild(btn);
      });
    }

    function submitAnswer(choiceIdx, correctIdx, questionIndex) {
      if (answered) return;
      answered = true;
      clearInterval(timerInterval);

      let gotItRight = (choiceIdx === correctIdx);
      if (gotItRight) score++;

      db.ref(`games/${gameId}/players/${playerKey}`).update({ score });

      db.ref(`games/${gameId}/answers/${playerKey}`).set({
        choiceIndex: choiceIdx,
        questionIndex: questionIndex,
        timestamp: Date.now()
      });

      updateScoreDisplay();

      // ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏™‡∏µ‡∏õ‡∏∏‡πà‡∏°‡∏ï‡∏≤‡∏°‡∏ñ‡∏π‡∏Å‡∏ú‡∏¥‡∏î
      document.querySelectorAll("#choices button").forEach((btn, idx) => {
        btn.disabled = true;
        if (idx === correctIdx) {
          btn.classList.add('correct');
        }
        if (idx === choiceIdx && choiceIdx !== correctIdx) {
          btn.classList.add('wrong');
        }
      });

      // ‡πÄ‡∏•‡πà‡∏ô‡πÄ‡∏™‡∏µ‡∏¢‡∏á‡πÅ‡∏¢‡∏Å‡∏ï‡∏≤‡∏°‡∏ñ‡∏π‡∏Å‡∏ú‡∏¥‡∏î
      if (gotItRight) {
        correctSound.play();
        setTimeout(() => {
          yaySound.play();
        }, 500);
      } else {
        wrongSound.play();
      }
    }

    function updateScore(game) {
      if (playerKey && game.players && game.players[playerKey]) {
        score = game.players[playerKey].score || 0;
      }
      updateScoreDisplay();
    }

    function updateScoreDisplay() {
      scoreDisplay.innerText = `‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì: ${score}`;
    }

    function startTimer(seconds) {
      let timeLeft = seconds;
      timerDiv.innerText = `üïí ${timeLeft} ‡∏ß‡∏¥‡∏ô‡∏≤‡∏ó‡∏µ`;
      timerInterval = setInterval(() => {
        timeLeft--;
        timerDiv.innerText = `üïí ${timeLeft} ‡∏ß‡∏¥‡∏ô‡∏≤‡∏ó‡∏µ`;
        if (timeLeft <= 0) {
          clearInterval(timerInterval);
          timerDiv.innerText = "‡∏´‡∏°‡∏î‡πÄ‡∏ß‡∏•‡∏≤!";
          answered = true;
          document.querySelectorAll("#choices button").forEach(btn => btn.disabled = true);
        }
      }, 1000);
    }
  </script>
</body>
</html>


